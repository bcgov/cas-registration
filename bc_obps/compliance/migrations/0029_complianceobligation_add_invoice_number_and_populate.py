# Generated by Django 5.1.15 on 2026-02-19 00:27

from django.db import migrations, models


def populate_invoice_number_for_existing_obligation_records(apps, schema_editor):
    ComplianceObligation = apps.get_model('compliance', 'ComplianceObligation')

    for obligation in ComplianceObligation.objects.all():
        if obligation.elicensing_invoice:
            obligation.invoice_number = obligation.elicensing_invoice.invoice_number
            obligation.save()


class Migration(migrations.Migration):

    dependencies = [
        ('compliance', '0028_V5_2_0'),
    ]

    operations = [
        migrations.AddField(
            model_name='complianceobligation',
            name='invoice_number',
            field=models.CharField(
                blank=True,
                db_comment='The invoice number for the related elicensing invoice. Populated immediately on invoice creation in elicensing to ensure the link is not lost between invoice creation in elicensing and the refresh function that creates the elicensing_invoice record in the erc data.',
                null=True,
            ),
        ),
        migrations.AddField(
            model_name='historicalcomplianceobligation',
            name='invoice_number',
            field=models.CharField(
                blank=True,
                db_comment='The invoice number for the related elicensing invoice. Populated immediately on invoice creation in elicensing to ensure the link is not lost between invoice creation in elicensing and the refresh function that creates the elicensing_invoice record in the erc data.',
                null=True,
            ),
        ),
        migrations.RunPython(
            populate_invoice_number_for_existing_obligation_records,
            migrations.RunPython.noop,
            elidable=True,
        ),
    ]
