import base64
from decimal import ROUND_HALF_UP, Decimal
import logging
from datetime import datetime
from pathlib import Path
from typing import Dict, Any, Tuple, Optional, Generator
from django.contrib.staticfiles.storage import staticfiles_storage
from django.template.loader import get_template
from django.template.exceptions import TemplateDoesNotExist

# Type ignore for weasyprint since it lacks stubs
from weasyprint import HTML  # type: ignore

logger = logging.getLogger(__name__)


class InvoiceService:
    """Service for generating PDF invoices for compliance obligations"""

    CHUNK_SIZE = 64 * 1024

    # ———————— hardcode Base64 for logo.png ————————
    _LOGO_BASE64 = (
        "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"
    )

    @classmethod
    def generate_invoice_pdf(
        cls,
        compliance_report_version_id: Optional[int] = None,
    ) -> Tuple[Generator[bytes, None, None], str, int]:
        """
        Generate a PDF invoice and return a generator that yields chunks of the PDF data.

        Args:
            compliance_report_version_id: ID of the compliance summary (not used in mock version)

        Returns:
            Tuple of (PDF data generator, filename, total_size_in_bytes)
        """
        context = InvoiceService._prepare_invoice_context()       
        # Use the embedded Base64 rather than reading a file
        context["logo_base64"] = cls._LOGO_BASE64

        try:
            template = get_template('invoice.html')
        except TemplateDoesNotExist:
            logger.error("Invoice template 'invoice.html' not found")
            raise ValueError("Failed to generate invoice: template not found")

        html_string = template.render(context)

        try:
            pdf_file = HTML(string=html_string).write_pdf()
        except Exception as e:
            logger.error(f"Failed to generate PDF: {str(e)}")
            raise ValueError("Failed to generate PDF invoice")

        filename = f"invoice_{context['invoice_number']}_{datetime.now().strftime('%Y%m%d')}.pdf"
        total_size = len(pdf_file)

        def pdf_generator() -> Generator[bytes, None, None]:
            for i in range(0, total_size, cls.CHUNK_SIZE):
                yield pdf_file[i : i + cls.CHUNK_SIZE]

        return pdf_generator(), filename, total_size

    @staticmethod
    def _prepare_invoice_context() -> Dict[str, Any]:
        """
        Prepare context data for the invoice template, including a list of fee_items
        and a total_amount that correctly sums them.
        """
        EQUIVALENT_NUMERIC = Decimal("16000.00")

        invoice_number        = "OBI000004"
        invoice_date          = "Dec 6, 2025"
        invoice_due_date      = "Jan 5, 2026"
        invoice_printed_date  = "Dec 4, 2025"
        operator_name         = "Colour Co."
        operator_address_line1= "111 COLOUR ST"
        operator_address_line2= "VANCOUVER, BC, V1V 1V1"
        operation_name        = "Pink Operation"
        operation_address_line1= "111 PINK RD"
        operation_address_line2= "VANCOUVER, BC, V1V 1V1"
        obligation_id         = "24-0001-1-1"
        compliance_obligation = "200.0000"

        # Build a list of 50 fee_items, each using a Decimal for "amount_numeric"
        fee_items: list[Dict[str, Any]] = []
        for i in range(1, 51):
            fee_items.append({
                "date":        invoice_date,
                "description": f"GGIRCA Compliance Obligation – item #{i}",
                "amount_numeric": EQUIVALENT_NUMERIC,
                # We’ll also store a formatted‐string version for convenience:
                "amount":      f"${EQUIVALENT_NUMERIC:,.2f}",
            })

        # Sum the numeric amounts:
        total_amount_numeric = sum(item["amount_numeric"] for item in fee_items)

        # Format that sum as a "$xx,xxx.xx" string
        # (ROUND_HALF_UP ensures normal “banker’s‐rounding” behavior)
        total_amount = f"${total_amount_numeric.quantize(Decimal('0.01'), rounding=ROUND_HALF_UP):,}"

        context = {
            "invoice_number":        invoice_number,
            "invoice_date":          invoice_date,
            "invoice_due_date":      invoice_due_date,
            "invoice_printed_date":  invoice_printed_date,
            "operator_name":         operator_name,
            "operator_address_line1":operator_address_line1,
            "operator_address_line2":operator_address_line2,
            "operation_name":        operation_name,
            "operation_address_line1":operation_address_line1,
            "operation_address_line2":operation_address_line2,
            "obligation_id":         obligation_id,
            "compliance_obligation": compliance_obligation,
            "fee_items":            fee_items,
            "total_amount":         total_amount,
        }
        return context
