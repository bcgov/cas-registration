# Generated by Django 5.0.11 on 2025-02-13 23:35

from django.db import migrations

"""
One-time forward-only migration to be applied to prod data.
Purpose: Remove the point_of_contact (created in Reg1) from the `operation` model and instead relate this contact to operations via contact.operator and the operation_contacts model.
"""


def migrate_point_of_contact(apps, schema_monitor):
    '''
    Migrate operation.point_of_contact to operation_contacts and contact.operator
    '''
    Operation = apps.get_model('registration', 'Operation')

    operations = Operation.objects.all()

    for operation in operations:
        if operation.point_of_contact:
            operation.contacts.add(operation.point_of_contact)
            operation.operator.contacts.add(operation.point_of_contact)

    for operation in operations:
        if operation.point_of_contact:
            assert operation.point_of_contact in operation.contacts.all()
            assert operation.point_of_contact in operation.operator.contacts.all()


class Migration(migrations.Migration):

    dependencies = [
        ('registration', '0078_V1_22_0'),
    ]

    operations = [
        migrations.RunPython(migrate_point_of_contact, migrations.RunPython.noop, elidable=True),
        migrations.RemoveField(
            model_name='historicaloperation',
            name='point_of_contact',
        ),
        migrations.RemoveField(
            model_name='operation',
            name='point_of_contact',
        ),
    ]
