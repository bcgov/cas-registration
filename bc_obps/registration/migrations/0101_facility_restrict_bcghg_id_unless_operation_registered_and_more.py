# Generated by Django 5.0.13 on 2025-04-01 19:47

import pgtrigger.compiler
import pgtrigger.migrations
from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [
        ('registration', '0100_address_protect_fields_empty_update_and_more'),
    ]

    operations = [
        pgtrigger.migrations.AddTrigger(
            model_name='facility',
            trigger=pgtrigger.compiler.Trigger(
                name='restrict_bcghg_id_unless_operation_registered',
                sql=pgtrigger.compiler.UpsertTriggerSql(
                    condition='WHEN (NEW."bcghg_id_id" IS NOT NULL)',
                    func="\n                    if (\n                        select status\n                        from erc.operation\n                        where erc.operation.id = new.operation_id\n                    ) != 'Registered' \n                    then\n                        raise exception 'Cannot assign bcghg_id to Facility unless the related Operation status is Registered';\n                    end if;\n                    return new;\n                ",
                    hash='c662b2cc070e4723d1186203b0dd08500e420b8f',
                    operation='INSERT OR UPDATE',
                    pgid='pgtrigger_restrict_bcghg_id_unless_operation_registered_51d82',
                    table='erc"."facility',
                    when='BEFORE',
                ),
            ),
        ),
        pgtrigger.migrations.AddTrigger(
            model_name='operation',
            trigger=pgtrigger.compiler.Trigger(
                name='restrict_bcghg_id_unless_registered',
                sql=pgtrigger.compiler.UpsertTriggerSql(
                    condition='WHEN (NEW."bcghg_id_id" IS NOT NULL)',
                    func="\n                    if new.status != 'Registered' \n                    then\n                        raise exception 'Cannot assign bcghg_id to Operation unless status is Registered';\n                    end if;\n                    return new;\n                ",
                    hash='03e4d829e9fcc0467efcabe411a77dc43c466a47',
                    operation='INSERT OR UPDATE',
                    pgid='pgtrigger_restrict_bcghg_id_unless_registered_48253',
                    table='erc"."operation',
                    when='BEFORE',
                ),
            ),
        ),
        pgtrigger.migrations.AddTrigger(
            model_name='operation',
            trigger=pgtrigger.compiler.Trigger(
                name='restrict_boro_id_unless_registered',
                sql=pgtrigger.compiler.UpsertTriggerSql(
                    condition='WHEN (NEW."bc_obps_regulated_operation_id" IS NOT NULL)',
                    func="\n                    if new.status != 'Registered' then\n                        raise exception 'Cannot assign bc_obps_regulated_operation to Operation unless status is Registered';\n                    end if;\n                    return new;\n                ",
                    hash='48955b4a31187f841878ae809a65e2560d331b1f',
                    operation='INSERT OR UPDATE',
                    pgid='pgtrigger_restrict_boro_id_unless_registered_ba9a4',
                    table='erc"."operation',
                    when='BEFORE',
                ),
            ),
        ),
    ]
