# Generated by Django 5.1.15 on 2026-02-14 00:52

import django.contrib.postgres.fields
import django.db.migrations.operations.special
import django.db.models.deletion
from django.db import migrations, models
from common.utils import reset_dashboard_data


# common.migrations.0002_admin_access_request_email_templates
def create_admin_access_request_email_notification_templates(apps, schema_editor):
    """
    Create EmailNotificationTemplates for the Admin Access Request workflow
    """

    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.create(
        name='Admin Access Request Confirmation',
        subject='BCIERS Receipt Acknowledgement – Administrator access request to {{ operator_legal_name }}',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p><br>
            <p>Dear {{ external_user_full_name }},</p><br>
            <p>Your administrator access request to {{ operator_legal_name }} in BCIERS has been received by the Climate Action Secretariat (CAS).</p>
            <p>CAS is reviewing your request. Please allow 3-5 business days to process this request. Once a decision is made, you may expect a notification email.</p><br>
            <p>If you have any questions, please contact our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca.</a></p><br>
            <p>Sent to: {{ external_user_email_address }}</p>
            <p>On behalf of the Climate Action Secretariat</p>
        ''',
    )
    EmailNotificationTemplate.objects.create(
        name='Admin Access Request Approved',
        subject='BCIERS Approval Notification – Administrator access request to {{ operator_legal_name }}',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p><br>
            <p>Dear {{ external_user_full_name }},</p><br>
            <p>Your administrator access request to {{ operator_legal_name }} in BCIERS has been approved by the Climate Action Secretariat.</p>
            <p>Please log back into <a href="https://registration.industrialemissions.gov.bc.ca">BCIERS</a> to perform additional tasks, such as starting an application for a BC OBPS Regulated Operation ID.</p><br>
            <p>If you have any questions, please contact our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca.</a></p><br>
            <p>Sent to: {{ external_user_email_address }}</p>
            <p>On behalf of the Climate Action Secretariat</p>
        ''',
    )
    EmailNotificationTemplate.objects.create(
        name='Admin Access Request Declined',
        subject='BCIERS Decline Notification – Administrator access request to {{ operator_legal_name }}',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p><br>
            <p>Dear {{ external_user_full_name }},</p><br>
            <p>Your administrator access request to {{ operator_legal_name }} in BCIERS has been declined by the Climate Action Secretariat.</p><br>
            <p>If you have any questions, please contact our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca.</a></p><br>
            <p>Sent to: {{ external_user_email_address }}</p>
            <p>On behalf of the Climate Action Secretariat</p>
        ''',
    )


def reverse_create_admin_access_request_email_notification_templates(apps, schema_editor):
    """
    Reverse the creation of the EmailNotificationTemplates for the Admin Access Request workflow
    """

    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.filter(
        name__in=[
            'Admin Access Request Confirmation',
            'Admin Access Request Approved',
            'Admin Access Request Declined',
        ],
    ).delete()


# common.migrations.0003_operator_access_request_email_templates
def create_operator_access_request_email_notification_templates(apps, schema_editor):
    """
    Create EmailNotificationTemplates for the Access Request to an existing operator with an existing admin
    """

    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.create(
        name='Operator With Admin Access Request Confirmation',
        subject='BCIERS Receipt Acknowledgement – Access request to {{ operator_legal_name }}',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p><br>
            <p>Dear {{ external_user_full_name }},</p><br>
            <p>Your access request to {{ operator_legal_name }} in BCIERS has been received.</p>
            <p>An operation representative with administrator access to {{ operator_legal_name }} should review your request. Once a decision is made, you may expect a notification email.</p><br>
            <p>If you have any questions, please contact our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca.</a></p><br>
            <p>Sent to: {{ external_user_email_address }}</p>
            <p>On behalf of the Climate Action Secretariat</p>
        ''',
    )
    EmailNotificationTemplate.objects.create(
        name='Operator With Admin Access Request Approved',
        subject='BCIERS Approval Notification – Access request to {{ operator_legal_name }}',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p><br>
            <p>Dear {{ external_user_full_name }},</p><br>
            <p>Your access request to {{ operator_legal_name }} in BCIERS has been approved by an operation representative with administrator access to {{ operator_legal_name }}.</p>
            <p>Please log back into <a href="https://registration.industrialemissions.gov.bc.ca">BCIERS</a> to perform additional tasks, such as starting an application for a BC OBPS Regulated Operation ID.</p><br>
            <p>If you have any questions, please contact our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca.</a></p><br>
            <p>Sent to: {{ external_user_email_address }}</p>
            <p>On behalf of the Climate Action Secretariat</p>
        ''',
    )
    EmailNotificationTemplate.objects.create(
        name='Operator With Admin Access Request Declined',
        subject='BCIERS Decline Notification – Access request to {{ operator_legal_name }}',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p><br>
            <p>Dear {{ external_user_full_name }},</p><br>
            <p>Your access request to {{ operator_legal_name }} in BCIERS has been declined by an operation representative with administrator access to {{ operator_legal_name }}.</p><br>
            <p>If you have any questions, please contact our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca.</a></p><br>
            <p>Sent to: {{ external_user_email_address }}</p>
            <p>On behalf of the Climate Action Secretariat</p>
        ''',
    )


def reverse_create_operator_access_request_email_notification_templates(apps, schema_editor):
    """
    Reverse the creation of the EmailNotificationTemplates for the Access Request to an existing operator with an existing admin
    """

    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.filter(
        name__in=[
            'Operator With Admin Access Request Confirmation',
            'Operator With Admin Access Request Approved',
            'Operator With Admin Access Request Declined',
        ],
    ).delete()


# common.migrations.0004_new_operator_and_admin_access_request_email_templates
def create_new_operator_and_admin_access_request_email_notification_templates(apps, schema_editor):
    """
    Create EmailNotificationTemplates for creating a new operator and granting admin access
    """

    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.create(
        name='New Operator And Admin Access Request Confirmation',
        subject='BCIERS Receipt Acknowledgement – Addition of {{ operator_legal_name }} and administrator access request',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p><br>
            <p>Dear {{ external_user_full_name }},</p><br>
            <p>Your request to add {{ operator_legal_name }} and obtain administrator access to its profile in BCIERS has been received by the Climate Action Secretariat (CAS).</p>
            <p>CAS is reviewing your requests. Please allow 3-5 business days to process this request. Once a decision is made, you may expect a notification email.</p><br>
            <p>If you have any questions, please contact our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca.</a></p><br>
            <p>Sent to: {{ external_user_email_address }}</p>
            <p>On behalf of the Climate Action Secretariat</p>
        ''',
    )
    EmailNotificationTemplate.objects.create(
        name='New Operator And Admin Access Request Approved',
        subject='BCIERS Approval Notification – Addition of {{ operator_legal_name }} and administrator access request',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p><br>
            <p>Dear {{ external_user_full_name }},</p><br>
            <p>Your request to add {{ operator_legal_name }} and obtain administrator access to its profile in BCIERS has been approved by Climate Action Secretariat.</p>
            <p>Please log back into <a href="https://registration.industrialemissions.gov.bc.ca">BCIERS</a> to perform additional tasks, such as starting an application for a BC OBPS Regulated Operation ID.</p><br>
            <p>If you have any questions, please contact our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca.</a></p><br>
            <p>Sent to: {{ external_user_email_address }}</p>
            <p>On behalf of the Climate Action Secretariat</p>
        ''',
    )
    EmailNotificationTemplate.objects.create(
        name='New Operator And Admin Access Request Declined',
        subject='BCIERS Decline Notification – Addition of {{ operator_legal_name }} and administrator access request',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p><br>
            <p>Dear {{ external_user_full_name }},</p><br>
            <p>Your requests to add {{ operator_legal_name }} and obtain administrator access to its profile in BCIERS has been declined by the Climate Action Secretariat.</p><br>
            <p>If you have any questions, please contact our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca.</a></p><br>
            <p>Sent to: {{ external_user_email_address }}</p>
            <p>On behalf of the Climate Action Secretariat</p>
        ''',
    )


def reverse_new_operator_and_admin_access_request_email_notification_templates(apps, schema_editor):
    """
    Reverse EmailNotificationTemplates for creating a new operator and granting admin access
    """

    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.filter(
        name__in=[
            'New Operator And Admin Access Request Confirmation',
            'New Operator And Admin Access Request Approved',
            'New Operator And Admin Access Request Declined',
        ],
    ).delete()


# common.migrations.0007_operation_boro_id_email_templates
def submit_operation_boro_id_email_notification_templates(apps, schema_editor):
    """
    Create EmailNotificationTemplate objects for confirming the submission of a BORO ID application, and for approving, declining, or requesting changes on the BORO ID application.
    """
    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.create(
        name='BORO ID Application Confirmation',
        subject='BCIERS Receipt Acknowledgement - BORO ID application for {{ operation_name }} of {{ operator_legal_name }}',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p><br>
            <p>Dear {{ external_user_full_name }},</p><br>
            <p>Your application to obtain a BC OBPS Regulated Operation ID (BORO ID) for {{ operation_name }} of {{ operator_legal_name }} has been received by the Climate Action Secretariat (CAS) through BCIERS.</p>
            <p>CAS is reviewing the application. Please allow 3-5 business days to process this request. Clarifications and changes may be requested as part of the reviewing process. Once a decision is made, you may expect a notification email.</p><br>
            <p>If you have any questions, please contact our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca.</a></p><br>
            <p>Sent to: {{ external_user_email_address }}</p>
            <p>On behalf of the Climate Action Secretariat</p>
        ''',
    )
    EmailNotificationTemplate.objects.create(
        name='BORO ID Application Approved',
        subject='BCIERS Approval Notification – BORO ID application for {{ operation_name }} of {{ operator_legal_name }}',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p><br>
            <p>Dear {{ external_user_full_name }},</p><br>
            <p>Your application to obtain a BC OBPS Regulated Operation ID (BORO ID) for {{ operation_name }} of {{ operator_legal_name }} has been approved by the Climate Action Secretariat.</p>
            <p>Please log back into <a href="https://registration.industrialemissions.gov.bc.ca/">BCIERS</a> to see {{ operation_name }}'s assigned BORO ID. For more information on how to use the BORO ID, please refer to <a href="https://www2.gov.bc.ca/assets/gov/environment/climate-change/ind/obps/guidance/bc_obps_guidance.pdf">Getting Started with the B.C. Output-Based Pricing System (gov.bc.ca)</a>.</p><br>
            <p>If you have any questions, please contact our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca.</a></p><br>
            <p>Sent to: {{ external_user_email_address }}</p>
            <p>On behalf of the Climate Action Secretariat</p>
        ''',
    )
    EmailNotificationTemplate.objects.create(
        name='BORO ID Application Declined',
        subject='BCIERS Decline Notification – BORO ID application for {{ operation_name }} of {{ operator_legal_name }}',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p><br>
            <p>Dear {{ external_user_full_name }},</p><br>
            <p>Your application to obtain a BC OBPS Regulated Operation ID (BORO ID) for {{ operation_name }} of {{ operator_legal_name }} has been declined by the Climate Action Secretariat.</p><br>
            <p>If you have any questions, please contact our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca.</a></p><br>
            <p>Sent to: {{ external_user_email_address }}</p>
            <p>On behalf of the Climate Action Secretariat</p>
        ''',
    )
    EmailNotificationTemplate.objects.create(
        name='BORO ID Application Changes Requested',
        subject='BCIERS Changes Request – BORO ID application for {{ operation_name }} of {{ operator_legal_name }}',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p><br>
            <p>Dear {{ external_user_full_name }},</p><br>
            <p>Changes are requested to your application to obtain a BC OBPS Regulated Operation ID (BORO ID) for {{ operation_name }} of {{ operator_legal_name }}.</p>
            <p>A staff member of the Climate Action Secretariat has sent, or will send shortly, an email explaining the details of the changes requested. Please revise and resubmit your application accordingly.</p><br>
            <p>If you have any questions, please contact our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca.</a></p><br>
            <p>Sent to: {{ external_user_email_address }}</p>
            <p>On behalf of the Climate Action Secretariat</p>
        ''',
    )


def reverse_submit_operation_boro_id_email_notification_templates(apps, schema_editor):
    """
    Reverse EmailNotificationTemplates for confirming the submission of a BORO ID application, and for approving, declining, or requesting changes on the BORO ID application.
    """
    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.filter(
        name__in=[
            'BORO ID Application Confirmation',
            'BORO ID Application Approved',
            'BORO ID Application Declined',
            'BORO ID Application Changes Requested',
        ]
    ).delete()


# common.migrations.0008_operation_opt_in_and_boro_id_email_templates
def opt_in_and_submit_operation_boro_id_email_notification_templates(apps, schema_editor):
    """
    Create EmailNotificationTemplate objects for confirming the submission of a BORO ID application, and for approving, declining, or requesting changes on the BORO ID application for opted-in operations.
    """
    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.create(
        name='Opt-in And BORO ID Application Confirmation',
        subject='BCIERS Receipt Acknowledgement - Opt-in and BORO ID application for {{ operation_name }} of {{ operator_legal_name }}',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p><br>
            <p>Dear {{ external_user_full_name }},</p><br>
            <p>Part of your application to opt-in as a reporting and regulated operation and obtain a BC OBPS Regulated Operation ID (BORO ID) for {{ operation_name }} of {{ operator_legal_name }} has been received by the Climate Action Secretariat (CAS) through BCIERS.</p>
            <p>A complete application requires additional documents to be sent to <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca.</a> according to <a href="https://www2.gov.bc.ca/gov/content/environment/climate-change/industry/bc-output-based-pricing-system#opting-in">B.C. Output-Based Pricing System - Province of British Columbia (gov.bc.ca)</a>.</p><br>
            <p>CAS will only review a complete application. Once a complete application has been received, please allow 3-5 business days to process this request. Clarifications and changes may be requested as part of the reviewing process. Once a decision is made, you may expect a notification email.</p><br>
            <p>If you have any questions, please contact our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca.</a></p><br>
            <p>Sent to: {{ external_user_email_address }}</p>
            <p>On behalf of the Climate Action Secretariat</p>
        ''',
    )

    EmailNotificationTemplate.objects.create(
        name='Opt-in And BORO ID Application Approved',
        subject='BCIERS Approval Notification – Opt-in and BORO ID application for {{ operation_name }} of {{ operator_legal_name }}',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p><br>
            <p>Dear {{ external_user_full_name }},</p><br>
            <p>Your application to opt-in as a reporting and regulated operation and obtain a BC OBPS Regulated Operation ID (BORO ID) for {{ operation_name }} of {{ operator_legal_name }} has been approved by the Climate Action Secretariat.</p>
            <p>Please log back into <a href="https://registration.industrialemissions.gov.bc.ca/">BCIERS</a> to see {{ operation_name }}'s assigned BORO ID. For more information on how to use the BORO ID, please refer to <a href="https://www2.gov.bc.ca/assets/gov/environment/climate-change/ind/obps/guidance/bc_obps_guidance.pdf">Getting Started with the B.C. Output-Based Pricing System (gov.bc.ca)</a>.</p><br>
            <p>If you have any questions, please contact our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca.</a></p><br>
            <p>Sent to: {{ external_user_email_address }}</p>
            <p>On behalf of the Climate Action Secretariat</p>
        ''',
    )
    EmailNotificationTemplate.objects.create(
        name='Opt-in And BORO ID Application Declined',
        subject='BCIERS Decline Notification – Opt-in and BORO ID application for {{ operation_name }} of {{ operator_legal_name }}',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p><br>
            <p>Dear {{ external_user_full_name }},</p><br>
            <p>Your application to opt-in as a reporting and regulated operation and obtain a BC OBPS Regulated Operation ID (BORO ID) for {{ operation_name }} of {{ operator_legal_name }} has been declined by the Climate Action Secretariat.</p><br>
            <p>If you have any questions, please contact our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca.</a></p><br>
            <p>Sent to: {{ external_user_email_address }}</p>
            <p>On behalf of the Climate Action Secretariat</p>
        ''',
    )
    EmailNotificationTemplate.objects.create(
        name='Opt-in And BORO ID Application Changes Requested',
        subject='BCIERS Changes Request – Opt-in and BORO ID application for {{ operation_name }} of {{ operator_legal_name }}',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p><br>
            <p>Dear {{ external_user_full_name }},</p><br>
            <p>Changes are requested to your application to opt-in as a reporting and regulated operation and obtain a BC OBPS Regulated Operation ID (BORO ID) for {{ operation_name }} of {{ operator_legal_name }}.</p>
            <p>A staff member of the Climate Action Secretariat has sent, or will send shortly, an email explaining the details of the changes requested. Please revise and resubmit your application accordingly.</p><br>
            <p>If you have any questions, please contact our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca.</a></p><br>
            <p>Sent to: {{ external_user_email_address }}</p>
            <p>On behalf of the Climate Action Secretariat</p>
        ''',
    )


def reverse_opt_in_and_submit_operation_boro_id_email_notification_templates(apps, schema_editor):
    """
    Reverse EmailNotificationTemplate objects for confirming the submission of a BORO ID application, and for approving, declining, or requesting changes on the BORO ID application for opted-in operations.
    """
    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.filter(
        name_in=[
            'Opt-in And BORO ID Application Confirmation',
            'Opt-in And BORO ID Application Approval',
            'Opt-in And BORO ID Application Declined',
            'Opt-in And BORO ID Application Changes Requested',
        ]
    ).delete()


# common.migrations.0047_boro_id_issuance_email_template
def create_boro_id_issuance_email_notification_template(apps, schema_editor):
    """
    Create EmailNotificationTemplate for the Notification of Issuance of BORO ID
    """
    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.create(
        name='BORO ID Issuance',
        subject='BCIERS Notification - BORO ID issued for {{ operation_name }} of {{ operator_legal_name }}',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p><br>
            <p>Dear {{ external_user_full_name }},</p><br>
            <p>{{ operation_name }} of {{ operator_legal_name }} has been issued a B.C. OBPS Regulated Operation ID (BORO ID) in BCIERS.</p>
            <p>Please log back into <a href="https://industrialemissions.gov.bc.ca">BCIERS</a> to see {{ operation_name }}'s assigned BORO ID. This BORO ID is required to complete a carbon tax exemption certificate, which is available on <a href="https://www2.gov.bc.ca/gov/content/taxes/sales-taxes/motor-fuel-carbon-tax/business/exemptions/obps-carbon-tax-exemption">this webpage</a>.</p><br>
            <p>If you have any questions, please contact our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca.</a></p><br>
            <p>Sent to: {{ external_user_email_address }}</p>
            <p>On behalf of the Climate Action Secretariat</p>
        ''',
    )


def reverse_create_boro_id_issuance_email_notification_template(apps, schema_editor):
    """
    Reverse the creation of the EmailNotificationTemplate for the Notification of Issuance of BORO ID
    """
    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.filter(name='BORO ID Issuance').delete()


# common.migrations.0048_admin_access_request_emails
def update_admin_access_request_email_notification_templates(apps, schema_editor):
    """
    Update EmailNotificationTemplates for the admin Access Request workflow
    """

    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')

    EmailNotificationTemplate.objects.filter(name='Admin Access Request Confirmation').update(
        subject='BCIERS Receipt Acknowledgement – Access Request to {{ operator_legal_name }}',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p><br>
            <p>Dear {{ external_user_full_name }},</p><br>
            <p>Your request to receive access to {{ operator_legal_name }} in BCIERS has been received by the Climate Action Secretariat (CAS).</p>
            <p>CAS is reviewing your request and will contact you within 3 business days to provide a status update.</p><br>
            <p>If you have any questions, please contact our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca.</a></p><br>
            <p>Sent to: {{ external_user_email_address }}</p>
            <p>On behalf of the Climate Action Secretariat</p>
        ''',
    )

    EmailNotificationTemplate.objects.filter(name='Admin Access Request Approved').update(
        subject='BCIERS Approval Notification – Access request to {{ operator_legal_name }}',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p><br>
            <p>Dear {{ external_user_full_name }},</p><br>
            <p>Your request to receive access to {{ operator_legal_name }} in BCIERS has been approved by the Climate Action Secretariat. You may now log back into <a href="https://registration.industrialemissions.gov.bc.ca">BCIERS</a> to register your operation(s).</p>
            <p>You have been granted administrator access for {{ operator_legal_name }}. This user role allows you to grant access and assign user roles to other individuals from your organization.</p><br>
            <p>If you have any questions, please contact our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca.</a></p><br>
            <p>Sent to: {{ external_user_email_address }}</p>
            <p>On behalf of the Climate Action Secretariat</p>
        ''',
    )
    EmailNotificationTemplate.objects.filter(name='Admin Access Request Declined').update(
        subject='BCIERS Decline Notification – Access request to {{ operator_legal_name }}',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p><br>
            <p>Dear {{ external_user_full_name }},</p><br>
            <p>Your request to receive access to {{ operator_legal_name }} in BCIERS has been declined by the Climate Action Secretariat.
            </p><br>
            <p>f you have any questions, please contact our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca.</a></p><br>
            <p>Sent to: {{ external_user_email_address }}</p>
            <p>On behalf of the Climate Action Secretariat</p>
        ''',
    )


# common.migrations.0049_access_request_emails
def update_operator_access_request_email_notification_templates(apps, schema_editor):
    """
    Update EmailNotificationTemplates for the Access Request to an existing operator with an existing admin
    """

    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.filter(name='Operator With Admin Access Request Confirmation').update(
        subject='BCIERS Receipt Acknowledgement – Access request to {{ operator_legal_name }}',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p><br>
            <p>Dear {{ external_user_full_name }},</p><br>
            <p>Your request to receive access to {{ operator_legal_name }} in BCIERS has been submitted.</p>
            <p>An operation representative with administrator access to {{ operator_legal_name }} can now review and approve your request. You will receive a notification email once a decision is made.</p><br>
            <p>If you have any questions, please contact our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca.</a></p><br>
            <p>Sent to: {{ external_user_email_address }}</p>
            <p>On behalf of the Climate Action Secretariat</p>
        ''',
    )
    EmailNotificationTemplate.objects.filter(name='Operator With Admin Access Request Approved').update(
        subject='BCIERS Approval Notification – Access request to {{ operator_legal_name }}',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p><br>
            <p>Dear {{ external_user_full_name }},</p><br>
            <p>Your request to receive access to {{ operator_legal_name }} in BCIERS has been approved by an operation representative with administrator access to {{ operator_legal_name }}. You may now log-in to <a href="https://registration.industrialemissions.gov.bc.ca">BCIERS</a> and access {{ operator_legal_name }}.
            </p><br>
            <p>If you have any questions, please contact our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca.</a></p><br>
            <p>Sent to: {{ external_user_email_address }}</p>
            <p>On behalf of the Climate Action Secretariat</p>
        ''',
    )
    EmailNotificationTemplate.objects.filter(name='Operator With Admin Access Request Declined').update(
        subject='BCIERS Decline Notification – Access request to {{ operator_legal_name }}',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p><br>
            <p>Dear {{ external_user_full_name }},</p><br>
            <p>Your request to receive access to {{ operator_legal_name }} in BCIERS has been declined by an operation representative with administrator access to {{ operator_legal_name }}.
</p><br>
            <p>If you have any questions, please reach out to the individual that holds administrator access to {{ operator_legal_name }}.</p><br>
            <p>Sent to: {{ external_user_email_address }}</p>
            <p>On behalf of the Climate Action Secretariat</p>
        ''',
    )


# common.migrations.0050_registration_submitted_email_template
def create_registration_submitted_email_template(apps, schema_editor):
    """
    Creates EmailNotificationTemplate for the Receipt Acknowledgement of Registration.
    """
    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.create(
        name='Registration Submission Acknowledgement',
        subject='BCIERS Receipt Acknowledgement – Registration Submitted for {{ operation_name }} of {{ operator_legal_name }}',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p><br>
            <p>Dear {{ external_user_full_name }},</p><br>
            <p>This email confirms that you have successfully submitted a registration for {{ operation_name }} of {{ operator_legal_name }} in BCIERS. You now have access to the Reporting Module in BCIERS where you can submit an annual report on behalf of {{ operation_name }}. A staff member from the Climate Action Secretariat will contact you if there are any questions about the registration information provided.
            </p><br>
            <p>If this operation is eligible to receive a B.C. OBPS Regulated Operation ID (BORO ID) and has not received one yet, Climate Action Secretariat staff will review the information provided and issue a BORO ID as applicable. You will receive an email notification if a BORO ID is issued to this operation.</p><br>
            <p>To return to BCIERS, click here: <a href="https://registration.industrialemissions.gov.bc.ca">registration.industrialemissions.gov.bc.ca/home</a></p><br>
            <p>If you have any questions, please contact our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca.</a></p><br>
            <p>Sent to: {{ external_user_email_address }}</p>
            <p>On behalf of the Climate Action Secretariat</p>
        ''',
    )


def reverse_create_registration_submitted_email_template(apps, schema_editor):
    """
    Reverses the creation of the EmailNotificationTemplate for Registration Submission Acknowledgement.
    """
    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.filter(name='Registration Submission Acknowledgement').delete()


# common.migrations.0076_notice_of_earned_credits_generated_notification_email_template
def create_earned_credit_notice_email_template(apps, schema_editor):
    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.create(
        name='Notice of Earned Credits Generated',
        subject='BCIERS Notification – Earned Credits Available to Request',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p>
            <br>
            <p>Dear {{ operator_legal_name }},</p>
            <br>
            <p>You can now review and request your earned credits using the BC Industrial Emissions Reporting System (BCIERS).</p>
            <p>Based on the information submitted in <b>{{ operation_name }}</b>&apos;s Annual Report for the {{ compliance_year }}
              compliance period, you can now request an issuance of {{ earned_credit_amount }} earned credit(s).
            </p>
            <p>To submit your earned credit request or review how it was calculated, please log-into BCIERS at <a
              href="https://industrialemissions.gov.bc.ca/onboarding">https://industrialemissions.gov.bc.ca/onboarding</a>.</p>
            <p>To request earned credit issuance:</p>
            <ol type="1">
              <li>Navigate to the Compliance module and click <em>My Compliance</em> > <em>Compliance Summaries</em>.</li>
              <li>Find your operation in the grid and click <em>Request Issuance of Credits</em>.</li>
            </ol>
            <p><b>Please note:</b> To receive your credits, you need to have an Operator of
              Regulated Operation account in the B.C.
              Carbon Registry. If you do not have an account of this type, please follow the steps outlined here: <a
                href="https://www2.gov.bc.ca/gov/content/environment/climate-change/industry/offset-projects/bc-carbon-registry">Accessing
              the BC Carbon Registry - Province of British Columbia</a>.
            </p>
            <p><em>Please do not reply to this email. This email is auto-generated and sent from an unmonitored address. If you have
              any questions, or need further assistance, please reach out to our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca</a>.</em>
            </p>
            <br>
            <p>Best Regards,</p>
            <p>Ministry of Energy and Climate Solutions</p>
            <p>Email: <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca</a></p>
            <p>Website: <a href="https://www2.gov.bc.ca/gov/content/environment/climate-change/industry/bc-output-based-pricing-system">BC
              Government Website Link</a>
            </p>
        ''',
    )


def reverse_earned_credit_notice_email_template(apps, schema_editor):
    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.filter(name='Notice of Earned Credits Generated').delete()


# common.migrations.0077_notice_of_no_obligation_no_credits_generated_notification_email_template
def create_no_obligation_no_credits_notice_email_template(apps, schema_editor):
    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.create(
        name='No Obligation No Earned Credits Generated',
        subject='BCIERS Notification – Compliance Obligation Met',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p>
            <br>
            <p>Dear {{ operator_legal_name }},</p>
            <br>
            <p>Based on the information submitted in <b>{{operation_name}}</b>'s  Annual Report for the {{ compliance_year }} compliance period, you have met your compliance obligation with no excess emissions or earned credits.  You can now review your records in the BC Industrial Emissions Reporting System (BCIERS). There is no further action required at this time.</p>
            <p>To review your compliance obligation, including how it was calculated, please log-into BCIERS at <a
              href="https://industrialemissions.gov.bc.ca/onboarding">https://industrialemissions.gov.bc.ca/onboarding</a>.</p>
            <p><em>Please do not reply to this email. This email is auto-generated and sent from an unmonitored address. If you have
              any questions, or need further assistance, please reach out to our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca</a>.</em>
            </p>
            <br>
            <p>Best Regards,</p>
            <p>Ministry of Energy and Climate Solutions</p>
            <p>Email: <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca</a></p>
            <p>Website: <a href="https://www2.gov.bc.ca/gov/content/environment/climate-change/industry/bc-output-based-pricing-system">BC
              Government Website Link</a>
            </p>
        ''',
    )


def reverse_no_obligation_no_credits_notice_email_template(apps, schema_editor):
    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.filter(name='No Obligation No Earned Credits Generated').delete()


# common.migrations.0081_notice_of_obligation_generated_notification_email_template
def create_obligation_notice_email_template(apps, schema_editor):
    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.create(
        name='Notice of Obligation Generated',
        subject='BCIERS Notification – Compliance Obligation Available to View',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p>
            <br>
            <p>Dear {{ operator_legal_name }},</p>
            <br>
            <p>You can now view your compliance obligation for the {{compliance_year}} compliance period in the BC Industrial Emissions Reporting System (BCIERS). This compliance obligation is based on the information submitted in <b>{{operation_name}}</b>'s Annual Report for the {{compliance_year}} compliance period. </p>
            <p>On <b>November 1, 2025</b>, the Ministry will issue an invoice to <b>{{operator_legal_name}}</b> based on <b>{{operation_name}}</b>'s excess emissions for the 2024 compliance period multiplied by the applicable compliance charge rate. On November 1, 2025, you will receive payment instructions and have the option to use compliance units to meet part of your obligation. </p>
            <p><b>Please note:</b> Payments cannot be made before you receive your invoice. Payments received after the payment deadline of November 30 will be subject to daily compounding penalties, as well as interest under the <em>Financial Administration Act</em> (FAA). We encourage you to make your monetary payment at least five business days in advance of the compliance obligation deadline to allow for payment processing time. </p>
            <p><em>Please do not reply to this email. This email is auto-generated and sent from an unmonitored address. If you have
              any questions, or need further assistance, please reach out to our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca</a>.</em>
            </p>
            <br>
            <p>Best Regards,</p>
            <p>Ministry of Energy and Climate Solutions</p>
            <p>Email: <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca</a></p>
            <p>Website: <a href="https://www2.gov.bc.ca/gov/content/environment/climate-change/industry/bc-output-based-pricing-system">BC
              Government Website Link</a>
            </p>
        ''',
    )


def reverse_obligation_notice_email_template(apps, schema_editor):
    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.filter(name='Notice of Obligation Generated').delete()


# common.migrations.0084_notice_of_credits_requested_notification_email_template
def create_credits_requested_email_template(apps, schema_editor):
    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.create(
        name='Notice of Credits Requested',
        subject='BCIERS Notification – Earned Credits Requested ',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p>
            <br>
            <p>Hi there,</p>
            <br>
            <p><b>{{operator_legal_name}}</b> has requested issuance of earned credits on behalf of <b>{{operation_name}}</b>. Please log-in to <a href="https://industrialemissions.gov.bc.ca/onboarding">BCIERS</a> to see the details of this request.
            <br>
            </p>
            <p><em>Please do not reply to this email. This email is auto-generated and sent from an unmonitored address.</em></p>
            <br>
            <p>Best Regards,</p>
            <p>Ministry of Energy and Climate Solutions</p>
            <p>Email: <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca</a></p>
            <p>Website: <a href="https://www2.gov.bc.ca/gov/content/environment/climate-change/industry/bc-output-based-pricing-system">BC
              Government Website Link</a>
            </p>
        ''',
    )


def reverse_credits_requested_email_template(apps, schema_editor):
    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.filter(name='Notice of Credits Requested').delete()


# common.migrations.0088_notice_of_obligation_due_email_template
def create_obligation_due_template(apps, schema_editor):
    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.create(
        name='Notice of Compliance Obligation Due',
        subject='BCIERS Notification – Compliance Obligation Due',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p>
            <br>
            <p>Dear {{operator_legal_name}},</p>
            <br>
            <p>You can now review your compliance obligation and take action to meet your obligation using the BC Industrial Emissions Reporting System (BCIERS).
            </p>
            <br>
            <p>Based on the information submitted in <b>{{operation_name}}</b>'s Annual Report for the {{compliance_period}} compliance period and the applicable compliance charge rate, a compliance obligation for excess emissions of {{tonnes_of_co2}} at an equivalent amount of  {{outstanding_balance}} is now payable.   </p>
            <br>
            <p>You have the option to use compliance units to meet part of your obligation. When you apply compliance units against your obligation, BCIERS automatically adjusts the equivalent monetary amount due on the invoice. To review your compliance obligation and how it was calculated, please log-into BCIERS at <a
              href="https://industrialemissions.gov.bc.ca/onboarding">https://industrialemissions.gov.bc.ca/onboarding</a>.</p><br>
            <p>To meet your compliance obligation:  </p>
            <ol>
            <li>Navigate to the Compliance module and click <em>My Compliance > Compliance Summaries</em>.</li>
            <li>Find your operation in the grid and click <em>Manage Obligation</em>.</li>
            </ol>
            <p>You must meet your compliance obligation by <b>November 30, {{year_due}}</b>.</p>
            <br>
            <p>
            <b>Please note:</b> Unmet obligations after the payment deadline of November 30 will be subject to daily compounding penalties, as well as interest under the <em>Financial Administration Act</em> (FAA).</p>
            <br >
            <p>
            <b>It may take up to five business days for payments to be processed and reconciled.</b> Once payment is received, BCIERS updates the obligation status accordingly. The Ministry uses the payment date to determine compliance with the deadline and whether a penalty exists. For clarity, the payment date is the date when payment is deposited to the B.C. OBPS bank account. If a payment date is on or before the deadline and processed after the deadline, BCIERS may temporarily show that a penalty exists until the payment is processed and the system refreshes the information. Please refer to the B.C. OBPS compliance module guidance document on our website for further information.  </p><br >
            <p><em>Please do not reply to this email. This email is auto-generated. If you have any questions, or need further assistance, please reach out to our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca</a></em></p>
            <br>
            <p>Best Regards,</p>
            <p>Ministry of Energy and Climate Solutions</p>
            <p>Email: <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca</a></p>
            <p>Website: <a href="https://www2.gov.bc.ca/gov/content/environment/climate-change/industry/bc-output-based-pricing-system">BC
              Government Website Link</a>
            </p>
        ''',
    )


def reverse_obligation_due_template(apps, schema_editor):
    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.filter(name='Notice of Compliance Obligation Due').delete()


# common.migrations.0091_reminder_of_obligation_due_email_template
def create_obligation_reminder_template(apps, schema_editor):
    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.create(
        name='Reminder of Compliance Obligation Due',
        subject='BCIERS Reminder – Compliance Obligation Due on November 30th',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p>
            <br/>
            <p>Dear {{operator_legal_name}},</p>
            <br/>
            <p>This is a reminder to meet your compliance obligation by <b>November 30, {{year_due}}</b>.
            </p>
            <br/>
            <p>Based on our records, <b>{{operation_name}}</b> has an outstanding compliance obligation of {{tonnes_of_co2}} in the amount of {{outstanding_balance}} that must be met using the BC Industrial Emissions Reporting System (BCIERS).
            </p>
            <br/>
            <p>If you have recently submitted payment and/or compliance units, please check that the details provided in your Payment Notification are accurate and that you have paid in full. It may take up to five business days for payments to be processed and reconciled.   </p><br/>
            <p>If the details in your Payment Notification are correct and you have met your compliance obligation, you may disregard this email. </p><br/>
            <p>If the payment information does not match the details provided in your Payment Notification email as required in the Payment Instructions available in BCIERS, we cannot process your payment.</p>
            <br/>



            <p>If you need to correct the details in your Payment Notification, please contact us at <a href="mailto:OBPSPayments@gov.bc.ca">OBPSPayments@gov.bc.ca</a>.
            </p>
            <br/ >
            <p>To review your compliance obligation, including how it was calculated, log-into BCIERS at <a
              href="https://industrialemissions.gov.bc.ca/onboarding">https://industrialemissions.gov.bc.ca/onboarding</a>.</p><br/>
            <p>To meet your compliance obligation:  </p>
            <ol>
            <li>Navigate to the Compliance module and click <em>My Compliance > Compliance Summaries</em>.</li>
            <li>Find your operation in the grid and click <em>Manage Obligation</em>.</li>
            </ol>

            <p>
            <b>Please note:</b> Unmet obligations after the payment deadline of November 30 will be subject to daily compounding penalties, as well as interest under the <em>Financial Administration Act</em> (FAA).  </p><br/>
            <p><b>It may take up to five business days for payments to be processed and reconciled.</b> Once payment is received, BCIERS updates the obligation status accordingly. The Ministry uses the payment date to determine compliance with the deadline and whether a penalty exists. For clarity, the payment date is the date when payment is deposited to the B.C. OBPS bank account. If a payment date is on or before the deadline and processed after the deadline, BCIERS may temporarily show that a penalty exists until the payment is processed and the system refreshes the information. Please refer to the B.C. OBPS compliance module guidance document on our website for further information.  </p><br/ >
            <p><em>Please do not reply to this email. This email is auto-generated. If you have any questions, or need further assistance, please reach out to our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca</a></em></p>
            <br/>
            <p>Best Regards,</p>
            <p>Ministry of Energy and Climate Solutions</p>
            <p>Email: <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca</a></p>
            <p>Website: <a href="https://www2.gov.bc.ca/gov/content/environment/climate-change/industry/bc-output-based-pricing-system">BC
              Government Website Link</a>
            </p>
        ''',
    )


def reverse_obligation_reminder_template(apps, schema_editor):
    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.filter(name='Reminder of Compliance Obligation Due').delete()


# common.migrations.0092_notice_of_obligation_met_email_template
def create_obligation_met_template(apps, schema_editor):
    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.create(
        name='Notice of Obligation Met',
        subject='BCIERS Notification – Compliance Obligation Met',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p>
            <br/>
            <p>Dear {{operator_legal_name}},</p>
            <br/>
            <p>This email confirms that the compliance obligation for <b>{{operation_name}}</b> based on its annual report for the {{compliance_period}} compliance period, has been met.
            </p>
            <br/>
            <p><em>Please do not reply to this email. This email is auto-generated. If you have any questions, or need further assistance, please reach out to our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca</a></em></p>
            <br/>
            <p>Best Regards,</p>
            <p>Ministry of Energy and Climate Solutions</p>
            <p>Email: <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca</a></p>
            <p>Website: <a href="https://www2.gov.bc.ca/gov/content/environment/climate-change/industry/bc-output-based-pricing-system">BC
              Government Website Link</a>
            </p>
        ''',
    )


def reverse_obligation_met_template(apps, schema_editor):
    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.filter(name='Notice of Obligation Met').delete()


# common.migrations.0095_notice_of_penalty_now_accruing_email_template
TEMPLATE_NAME = "Compliance Obligation Due Date Passed - Penalty now Accruing"
TEMPLATE_SUBJECT = "BCIERS Notification – Compliance Obligation Unmet"

TEMPLATE_BODY = '''
    <p style="text-align: center;">Province of British Columbia</p>
    <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p>
    <br/>
    <p>Dear {{operator_legal_name}},</p>
    <br/>
    <p>
        Based on our records, <b>{{operation_name}}</b> has an unmet compliance obligation
        <b>{{tonnes_of_co2}}</b> in the amount of <b>{{outstanding_balance}}</b>.
    </p>
    <br/>
    <p>
        The unmet compliance obligation is now subject to daily compounding penalties, as well as interest under
        the <i>Financial Administration Act</i> (FAA). These charges will continue to accrue until the outstanding
        obligation is met. Upon meeting the obligation, the BCIERS will calculate and invoice the amount of the
        penalty. You will be able to pay the penalty and interest once you receive the penalty invoice.
    </p>
    <br/>
    <p>
        To review your compliance obligation and/or penalty, including how it was calculated, log-into BCIERS at
        <a href="https://industrialemissions.gov.bc.ca/onboarding">https://industrialemissions.gov.bc.ca/onboarding</a>.
    </p>
    <p>To meet your compliance obligation:</p>
    <ol>
        <li>Navigate to the Compliance module and click <i>My Compliance &gt; Compliance Summaries</i>.</li>
        <li>Find your operation in the grid and click <em>Manage Obligation</em>.</li>
    </ol>
    <br/>
    <p>
        <b>Please Note:</b> It may take up to five business days for payments to be processed and reconciled.
        Once payment is received, BCIERS updates the obligation status accordingly. The Ministry uses the payment
        date to determine compliance with the deadline and whether a penalty exists. For clarity, the payment date
        is the date when payment is deposited to the B.C. OBPS bank account. If a payment date is on or before
        the November 30 deadline and processed after the deadline, BCIERS may temporarily show that a penalty
        exists until the payment is processed and the system refreshes the information. Please refer to the
        B.C. OBPS compliance module guidance document on our website for further information.
    </p>
    <br/>
    <p>
        If you have recently submitted payment and/or compliance units, please check that the details provided in
        your Payment Notification are accurate and that you have paid in full.
    </p>
    <p>
        If the details in your Payment Notification are correct and you have met your compliance obligation,
        you may disregard this email.
    </p>
    <p>
        If the payment information does not match the details provided in your Payment Notification email as
        required in the Payment Instructions available in BCIERS, we cannot process your payment.
    </p>
    <br/>
    <p>
        If you need to correct the payment information you have provided, please contact us at
        <a href="mailto:OBPSPayments@gov.bc.ca">OBPSPayments@gov.bc.ca</a>.
    </p>
    <br/>
    <p><em>
        Please do not reply to this email. This email is auto-generated. If you have any questions, or need
        further assistance, please reach out to our support team at
        <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca</a>.
    </em></p>
    <br/>
    <p>Best Regards,</p>
    <p>Ministry of Energy and Climate Solutions</p>
    <p>Email: <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca</a></p>
    <p>Website: <a href="https://www2.gov.bc.ca/gov/content/environment/climate-change/industry/bc-output-based-pricing-system">
        BC Government Website Link</a>
    </p>
'''


def create_penalty_accrual_template(apps, schema_editor):
    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.create(
        name=TEMPLATE_NAME,
        subject=TEMPLATE_SUBJECT,
        body=TEMPLATE_BODY,
    )


def reverse_penalty_accrual_template(apps, schema_editor):
    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.filter(name=TEMPLATE_NAME).delete()


# common.migrations.0097_supplementary_report_submitted_after_deadline_template_template
def supplementary_report_submitted_after_deadline_template(apps, schema_editor):
    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.create(
        name='Supplementary Report Submitted after Deadline',
        subject='BCIERS Notification – Supplementary Report Submitted after Deadline',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p>
            <br/>
            <p>Dear {{operator_legal_name}},</p>
            <br/>
            <p>Thank you for submitting a supplementary report through the BC Industrial Emissions Reporting System (BCIERS).
            </p>
            <br/>
            <p>Because your supplementary report results in an increased amount of excess emissions, <b>you must meet an additional compliance obligation</b>. Based on the information submitted in <b>{{operation_name}}</b>'s supplementary report and the applicable compliance charge rate, an additional compliance obligation for excess emissions of {{tonnes_of_co2}} at an equivalent amount of {{outstanding_balance}} is now payable.   </p>
            <br/>
            <p><b>Because the supplementary report was submitted after the compliance obligation deadline</b>, the additional compliance obligation is subject to interest under the Greenhouse Gas Emission Administrative Penalty and Appeals Regulation (GGEAPAR). Interest is calculated at the prime lending rate + 3%, compounded monthly from the compliance obligation deadline of November 30, {{year_due}} and applies until you resolve the overdue obligation.</p>
            <br/><p>To review your compliance obligation and how it was calculated, please log-into BCIERS at <a
              href="https://industrialemissions.gov.bc.ca/onboarding">https://industrialemissions.gov.bc.ca/onboarding</a>.</p><br/>
            <p>To meet your compliance obligation:  </p>
            <ol>
            <li>Navigate to the Compliance module and click <em>My Compliance > Compliance Summaries</em>.</li>
            <li>Find your operation in the grid and click <em>Manage Obligation</em>.</li>
            </ol>
            <p>If you do not meet the additional compliance obligation <b>within 30 days</b>, the additional obligation will be subject to daily compounding penalties, as well as interest under the <i>Financial Administration Act</i> (FAA). We strongly encourage you to make your payment on time to avoid these additional charges. Please refer to the B.C. OBPS compliance module guidance document on our website for further information. </p><br/>
            <p><em>Please do not reply to this email. This email is auto-generated. If you have any questions, or need further assistance, please reach out to our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca</a></em></p>
            <br/>
            <p>Best Regards,</p>
            <p>Ministry of Energy and Climate Solutions</p>
            <p>Email: <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca</a></p>
            <p>Website: <a href="https://www2.gov.bc.ca/gov/content/environment/climate-change/industry/bc-output-based-pricing-system">BC
              Government Website Link</a>
            </p>
        ''',
    )


def reverse_supplementary_report_submitted_after_deadline_template(apps, schema_editor):
    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.filter(name='Supplementary Report Submitted after Deadline').delete()


# common.migrations.0099_update_dashboard_data
def reset_dashboard_data_fn(_, schema_editor):
    reset_dashboard_data()


class Migration(migrations.Migration):

    replaces = [
        ('common', '0001_initial'),
        ('common', '0002_admin_access_request_email_templates'),
        ('common', '0003_operator_access_request_email_templates'),
        ('common', '0004_new_operator_and_admin_access_request_email_templates'),
        ('common', '0005_V1_5_0'),
        ('common', '0006_V1_5_1'),
        ('common', '0007_operation_boro_id_email_templates'),
        ('common', '0008_operation_opt_in_and_boro_id_email_templates'),
        ('common', '0009_V1_5_2'),
        ('common', '0010_dashboarddata'),
        ('common', '0011_V1_6_0'),
        ('common', '0012_update_dashboard_data'),
        ('common', '0013_V1_7_0'),
        ('common', '0014_V1_8_0'),
        ('common', '0015_V1_9_0'),
        ('common', '0016_update_dashboard_data'),
        ('common', '0017_update_dashboard_data'),
        ('common', '0018_V1_10_0'),
        ('common', '0019_V1_11_0'),
        ('common', '0020_update_dashboard_data'),
        ('common', '0021_V1_12_0'),
        ('common', '0022_update_dashboard_data'),
        ('common', '0023_V1_13_0'),
        ('common', '0024_V1_14_0'),
        ('common', '0025_V1_15_0'),
        ('common', '0026_update_dashboard_data_20241206_1633'),
        ('common', '0027_V1_16_0'),
        ('common', '0028_V1_17_0'),
        ('common', '0029_V1_17_1'),
        ('common', '0030_V1_18_0'),
        ('common', '0031_V1_19_0'),
        ('common', '0032_V1_20_0'),
        ('common', '0033_update_dashboard_data'),
        ('common', '0034_V1_21_0'),
        ('common', '0035_V1_22_0'),
        ('common', '0036_V1_23_0'),
        ('common', '0037_V1_23_1'),
        ('common', '0038_V1_24_0'),
        ('common', '0039_update_dashboard_data'),
        ('common', '0040_V2_0_0'),
        ('common', '0041_V2_0_1'),
        ('common', '0042_V2_1_1'),
        ('common', '0043_V2_2_0'),
        ('common', '0044_update_dashboard_data'),
        ('common', '0045_V2_3_0'),
        ('common', '0046_V3_0_0'),
        ('common', '0047_boro_id_issuance_email_template'),
        ('common', '0048_admin_access_request_emails'),
        ('common', '0049_access_request_emails'),
        ('common', '0050_registration_submitted_email_template'),
        ('common', '0051_auto_20250430_1758'),
        ('common', '0052_V3_1_0'),
        ('common', '0053_update_dashboard_data'),
        ('common', '0054_V3_2_0'),
        ('common', '0055_V3_2_1'),
        ('common', '0056_update_dashboard_data'),
        ('common', '0057_V3_3_0'),
        ('common', '0058_V3_4_1'),
        ('common', '0059_V3_5_0'),
        ('common', '0060_V3_6_0'),
        ('common', '0061_V3_7_0'),
        ('common', '0062_V3_8_0'),
        ('common', '0063_V3_8_1'),
        ('common', '0064_V3_9_0'),
        ('common', '0065_V3_10_0'),
        ('common', '0066_V3_11_0'),
        ('common', '0067_V3_12_0'),
        ('common', '0068_V3_13_0'),
        ('common', '0069_V3_14_0'),
        ('common', '0070_V3_15_0'),
        ('common', '0071_update_dashboard_data'),
        ('common', '0072_V3_16_0'),
        ('common', '0073_update_dashboard_data'),
        ('common', '0074_V3_17_1'),
        ('common', '0075_update_dashboard_data'),
        ('common', '0076_notice_of_earned_credits_generated_notification_email_template'),
        ('common', '0077_notice_of_no_obligation_no_credits_generated_notification_email_template'),
        ('common', '0078_V3_18_0'),
        ('common', '0079_update_internal_dashboard_data'),
        ('common', '0080_V3_19_0'),
        ('common', '0081_notice_of_obligation_generated_notification_email_template'),
        ('common', '0082_V3_20_0'),
        ('common', '0083_update_dashboard_data'),
        ('common', '0084_notice_of_credits_requested_notification_email_template'),
        ('common', '0085_V4_0_0'),
        ('common', '0086_V4_0_1'),
        ('common', '0087_V4_1_0'),
        ('common', '0088_notice_of_obligation_due_email_template'),
        ('common', '0089_update_dashboard_data'),
        ('common', '0090_V4_2_0'),
        ('common', '0091_reminder_of_obligation_due_email_template'),
        ('common', '0092_notice_of_obligation_met_email_template'),
        ('common', '0093_V4_3_0'),
        ('common', '0094_update_dashboard_data'),
        ('common', '0095_notice_of_penalty_now_accruing_email_template'),
        ('common', '0096_V4_4_0'),
        ('common', '0097_supplementary_report_submitted_after_deadline_template_template'),
        ('common', '0098_V4_5_0'),
        ('common', '0099_update_dashboard_data'),
        ('common', '0100_V4_6_0'),
        ('common', '0101_V4_6_1'),
        ('common', '0102_V4_7_0'),
        ('common', '0103_V4_7_1'),
        ('common', '0104_V5_0_0'),
    ]

    dependencies = []

    operations = [
        migrations.CreateModel(
            name='EmailNotificationTemplate',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                (
                    'name',
                    models.CharField(
                        db_comment='Name of the email template as a unique identifier', max_length=255, unique=True
                    ),
                ),
                ('subject', models.CharField(db_comment='Subject of the email template', max_length=255)),
                ('body', models.TextField(db_comment='Body of the email template')),
            ],
            options={
                'db_table': 'common"."email_notification_template',
                'db_table_comment': 'Stores email templates for notifications',
            },
        ),
        migrations.CreateModel(
            name='EmailNotification',
            fields=[
                (
                    'transaction_id',
                    models.UUIDField(
                        db_comment='Transaction identifier for the email message in CHES API',
                        editable=False,
                        primary_key=True,
                        serialize=False,
                    ),
                ),
                (
                    'message_id',
                    models.UUIDField(db_comment='Message identifier for the email message in CHES API', editable=False),
                ),
                (
                    'recipients_email',
                    django.contrib.postgres.fields.ArrayField(
                        base_field=models.EmailField(max_length=255),
                        db_comment='List of email addresses to send the email to',
                        size=None,
                    ),
                ),
                (
                    'template',
                    models.ForeignKey(
                        db_comment='Email template to use for the email notification',
                        on_delete=django.db.models.deletion.DO_NOTHING,
                        related_name='email_notifications',
                        to='common.emailnotificationtemplate',
                    ),
                ),
            ],
            options={
                'db_table': 'common"."email_notification',
                'db_table_comment': 'Stores email notifications after they have been sent',
            },
        ),
        migrations.RunPython(
            code=create_admin_access_request_email_notification_templates,
            reverse_code=reverse_create_admin_access_request_email_notification_templates,
        ),
        migrations.RunPython(
            code=create_operator_access_request_email_notification_templates,
            reverse_code=reverse_create_operator_access_request_email_notification_templates,
        ),
        migrations.RunPython(
            code=create_new_operator_and_admin_access_request_email_notification_templates,
            reverse_code=reverse_new_operator_and_admin_access_request_email_notification_templates,
        ),
        migrations.RunPython(
            code=submit_operation_boro_id_email_notification_templates,
            reverse_code=reverse_submit_operation_boro_id_email_notification_templates,
        ),
        migrations.RunPython(
            code=opt_in_and_submit_operation_boro_id_email_notification_templates,
            reverse_code=reverse_opt_in_and_submit_operation_boro_id_email_notification_templates,
        ),
        migrations.CreateModel(
            name='DashboardData',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                (
                    'name',
                    models.CharField(
                        db_comment='Name of the dashboard by app and ID type used as a friendly unique identifier.',
                        max_length=100,
                        unique=True,
                    ),
                ),
                ('data', models.JSONField(db_comment='JSON representation of dashboard navigation tiles.')),
            ],
            options={
                'db_table': 'common"."dashboard_data',
                'db_table_comment': 'The JSON information for dashboard navigation tiles by app and ID type.',
            },
        ),
        migrations.RunPython(
            code=create_boro_id_issuance_email_notification_template,
            reverse_code=reverse_create_boro_id_issuance_email_notification_template,
        ),
        migrations.RunPython(
            code=update_admin_access_request_email_notification_templates,
            reverse_code=django.db.migrations.operations.special.RunPython.noop,
        ),
        migrations.RunPython(
            code=update_operator_access_request_email_notification_templates,
            reverse_code=django.db.migrations.operations.special.RunPython.noop,
        ),
        migrations.RunPython(
            code=create_registration_submitted_email_template,
            reverse_code=reverse_create_registration_submitted_email_template,
        ),
        migrations.RunPython(
            code=create_earned_credit_notice_email_template,
            reverse_code=reverse_earned_credit_notice_email_template,
        ),
        migrations.RunPython(
            code=create_no_obligation_no_credits_notice_email_template,
            reverse_code=reverse_no_obligation_no_credits_notice_email_template,
        ),
        migrations.RunPython(
            code=create_obligation_notice_email_template,
            reverse_code=reverse_obligation_notice_email_template,
        ),
        migrations.RunPython(
            code=create_credits_requested_email_template,
            reverse_code=reverse_credits_requested_email_template,
        ),
        migrations.RunPython(
            code=create_obligation_due_template,
            reverse_code=reverse_obligation_due_template,
        ),
        migrations.RunPython(
            code=create_obligation_reminder_template,
            reverse_code=reverse_obligation_reminder_template,
        ),
        migrations.RunPython(
            code=create_obligation_met_template,
            reverse_code=reverse_obligation_met_template,
        ),
        migrations.RunPython(
            code=create_penalty_accrual_template,
            reverse_code=reverse_penalty_accrual_template,
        ),
        migrations.RunPython(
            code=supplementary_report_submitted_after_deadline_template,
            reverse_code=reverse_supplementary_report_submitted_after_deadline_template,
        ),
        migrations.RunPython(
            code=reset_dashboard_data_fn,
        ),
    ]
