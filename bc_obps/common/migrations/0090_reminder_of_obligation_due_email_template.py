# Generated by Django 5.1.10 on 2025-10-07 21:57

from django.db import migrations


def create_obligation_reminder_template(apps, schema_editor):
    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.create(
        name='Reminder of Compliance Obligation Due',
        subject='BCIERS Reminder â€“ Compliance Obligation Due on November 30th',
        body='''
            <p style="text-align: center;">Province of British Columbia</p>
            <p style="text-align: center;">B.C. Industrial Emissions Reporting System (BCIERS)</p>
            <br/>
            <p>Dear {{operator_legal_name}},</p>
            <br/>
            <p>This is a reminder to meet your compliance obligation by <b>November 30, {{year_due}}</b>.
            </p>
            <br/>
            <p>Based on our records, <b>{{operation_name}}</b> has an outstanding compliance obligation of {{tonnes_of_co2}} in the amount of {{outstanding_balance}} that must be met using the BC Industrial Emissions Reporting System (BCIERS).
            </p>
            <br/>
            <p>If you have recently submitted payment and/or compliance units, please check that the details provided in your Payment Notification are accurate and that you have paid in full. It may take up to five business days for payments to be processed and reconciled.   </p><br/>
            <p>If the details in your Payment Notification are correct and you have met your compliance obligation, you may disregard this email. </p><br/>
            <p>If the payment information does not match the details provided in your Payment Notification email as required in the Payment Instructions available in BCIERS, we cannot process your payment.</p>
            <br/>



            <p>If you need to correct the details in your Payment Notification, please contact us at <a href="mailto:OBPSPayments@gov.bc.ca">OBPSPayments@gov.bc.ca</a>.
            </p>
            <br/ >
            <p>To review your compliance obligation, including how it was calculated, log-into BCIERS at <a
              href="https://industrialemissions.gov.bc.ca/onboarding">https://industrialemissions.gov.bc.ca/onboarding</a>.</p><br/>
            <p>To meet your compliance obligation:  </p>
            <ol>
            <li>Navigate to the Compliance module and click <em>My Compliance > Compliance Summaries</em>.</li>
            <li>Find your operation in the grid and click <em>Manage Obligation</em>.</li>
            </ol>

            <p>
            <b>Please note:</b> Unmet obligations after the payment deadline of November 30 will be subject to daily compounding penalties, as well as interest under the <em>Financial Administration Act</em> (FAA).  </p><br/>
            <p><b>It may take up to five business days for payments to be processed and reconciled.</b> Once payment is received, BCIERS updates the obligation status accordingly. The Ministry uses the payment date to determine compliance with the deadline and whether a penalty exists. For clarity, the payment date is the date when payment is deposited to the B.C. OBPS bank account. If a payment date is on or before the deadline and processed after the deadline, BCIERS may temporarily show that a penalty exists until the payment is processed and the system refreshes the information. Please refer to the B.C. OBPS compliance module guidance document on our website for further information.  </p><br/ >
            <p><em>Please do not reply to this email. This email is auto-generated. If you have any questions, or need further assistance, please reach out to our support team at <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca</a></em></p>
            <br/>
            <p>Best Regards,</p>
            <p>Ministry of Energy and Climate Solutions</p>
            <p>Email: <a href="mailto:GHGRegulator@gov.bc.ca">GHGRegulator@gov.bc.ca</a></p>
            <p>Website: <a href="https://www2.gov.bc.ca/gov/content/environment/climate-change/industry/bc-output-based-pricing-system">BC
              Government Website Link</a>
            </p>
        ''',
    )


def reverse_obligation_reminder_template(apps, schema_editor):
    EmailNotificationTemplate = apps.get_model('common', 'EmailNotificationTemplate')
    EmailNotificationTemplate.objects.filter(name='Reminder of Compliance Obligation Due').delete()


class Migration(migrations.Migration):
    dependencies = [
        ('common', '0089_update_dashboard_data'),
    ]

    operations = [
        migrations.RunPython(
            create_obligation_reminder_template,
            reverse_obligation_reminder_template,
            elidable=True,
        )
    ]
