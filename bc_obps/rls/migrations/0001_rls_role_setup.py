# Generated by Django 5.0.8 on 2024-12-04 21:33

from django.db import migrations
from django.db import connection


def init_roles(apps, schema_monitor):
    with connection.cursor() as cursor:
        cursor.execute("SELECT role_name FROM erc.app_role;")
        roles = cursor.fetchall()
        for role in roles:
            cursor.execute("CREATE ROLE %s", [role[0]])
            cursor.execute("GRANT USAGE ON SCHEMA erc TO %s", [role[0]])


def reverse_init_roles(apps, schema_monitor):
    with connection.cursor() as cursor:
        cursor.execute("SELECT role_name FROM erc.app_role;")
        roles = cursor.fetchall()
        for role in roles:
            cursor.execute("REVOKE USAGE ON SCHEMA erc FROM %s", [role[0]])
            cursor.execute("DROP ROLE %s", [role[0]])


class Migration(migrations.Migration):

    dependencies = [
        ('common', '0025_V1_15_0'),
    ]

    operations = [migrations.RunPython(init_roles, reverse_init_roles)]
