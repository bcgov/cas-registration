# Generated by Django 5.1.15 on 2026-02-05 19:02

import django.contrib.postgres.constraints
import django.contrib.postgres.fields.ranges
import django.db.models.deletion
import reporting.models.naics_regulatory_override
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('registration', '0158_add_pulp_and_paper_product'),
        ('reporting', '0152_report_operation_final_reporting_year'),
    ]

    operations = [
        migrations.CreateModel(
            name='NaicsRegulatoryOverride',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                (
                    'reduction_factor',
                    models.DecimalField(
                        db_comment='\n            The Province developed distinct reduction factors for products in the B.C. OBPS with disproportionately\n            higher industrial process emissions than those produced in other sectors. \n            https://www2.gov.bc.ca/assets/gov/environment/climate-change/action/carbon-tax/obps-technical-backgrounder.pdf\n            \n            This field overrides the default industry reduction factor for a particular product, if it exists\n            ',
                        decimal_places=4,
                        max_digits=5,
                    ),
                ),
                (
                    'tightening_rate',
                    models.DecimalField(
                        db_comment='\n            Tightening rates are planned, yearly, gradual increases to BC OBPS stringency.\n            https://www2.gov.bc.ca/assets/gov/environment/climate-change/action/carbon-tax/obps-technical-backgrounder.pdf\n\n            This field overrides the default industry tightening rate for a particular product, if it exists\n            ',
                        decimal_places=4,
                        max_digits=5,
                    ),
                ),
                (
                    'valid_from',
                    models.DateField(
                        blank=True, db_comment='Date from which the regulatory values override is applicable', null=True
                    ),
                ),
                (
                    'valid_to',
                    models.DateField(
                        blank=True,
                        db_comment='Date until which the regulatory values override is applicable',
                        null=True,
                    ),
                ),
                (
                    'naics_code',
                    models.ForeignKey(
                        db_comment='Foreign key to the naics_code record that is associated with the regulatory value override in this record',
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name='regulatory_values_overrides',
                        to='registration.naicscode',
                    ),
                ),
                (
                    'regulated_product',
                    models.ForeignKey(
                        db_comment='Foreign key to the regulated_product record associated with the regulatory values override in this record',
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name='regulatory_values_overrides',
                        to='registration.regulatedproduct',
                    ),
                ),
            ],
            options={
                'db_table': 'erc"."naics_regulatory_override',
                'db_table_comment': '\n            This table contains the regulatory values overrides that apply to a naics code and a product, \n            within a set timeframe from where the values are valid and when the values are no longer valid.\n            ',
                'constraints': [
                    django.contrib.postgres.constraints.ExclusionConstraint(
                        expressions=[
                            (
                                reporting.models.naics_regulatory_override.TsTzRange(
                                    'valid_from', 'valid_to', django.contrib.postgres.fields.ranges.RangeBoundary()
                                ),
                                '&&',
                            ),
                            ('naics_code', '='),
                        ],
                        name='exclude_overlapping_naics_regulatory_override_records_by_date_range',
                    )
                ],
            },
        ),
    ]
