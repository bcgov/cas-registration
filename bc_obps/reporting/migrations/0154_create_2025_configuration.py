# Generated by Django 5.1.15 on 2026-02-05 20:00

from django.db import migrations


def create_2025_configuration(apps, schema_editor):
    """
    Create new Configuration for 2025 onwards and update existing 2024 configuration to end in 2024.
    This enables a configuration split for the new Pulp & Paper biogenic emissions requirements.
    """
    Configuration = apps.get_model('reporting', 'Configuration')

    # Update the existing 2024 configuration to end at 2025-12-31
    config_2024 = Configuration.objects.get(slug='2024', valid_from='2023-01-01')
    config_2024.valid_to = '2024-12-31'
    config_2024.save()

    # Create new configuration for 2025 onwards
    Configuration.objects.create(slug='2025', valid_from='2025-01-01', valid_to='2099-12-31')


def reverse_create_2025_configuration(apps, schema_editor):
    """
    Reverse the configuration split by removing 2025 config and restoring 2024 config to 2099-12-31.
    """
    Configuration = apps.get_model('reporting', 'Configuration')

    # Delete the 2025 configuration
    Configuration.objects.filter(slug='2025').delete()

    # Restore the 2024 configuration to end at 2099-12-31
    config_2024 = Configuration.objects.get(slug='2024', valid_from='2023-01-01')
    config_2024.valid_to = '2099-12-31'
    config_2024.save()


class Migration(migrations.Migration):

    dependencies = [
        ('reporting', '0153_V5_2_0'),
    ]

    operations = [
        migrations.RunPython(create_2025_configuration, reverse_create_2025_configuration),
    ]
