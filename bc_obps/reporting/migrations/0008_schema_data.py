# Generated by Django 5.0.6 on 2024-07-02 21:16
from django.db import migrations
import json


# ACTIVITY
def init_activity_schema_data(apps, schema_monitor):
    '''
    Add initial schema data to erc.activity_schema
    '''
    ## Import JSON data
    import os

    cwd = os.getcwd()
    with open(f'{cwd}/reporting/json_schemas/2024/general_stationary_combustion/activity.json') as gsc_st1:
        schema = json.load(gsc_st1)

    ActivitySchema = apps.get_model('reporting', 'ActivityJsonSchema')
    ReportingActivity = apps.get_model('registration', 'ReportingActivity')
    Configuration = apps.get_model('registration', 'Configuration')
    ActivitySchema.objects.create(
        reporting_activity_id=ReportingActivity.objects.get(name='General stationary combustion').id,
        json_schema=schema,
        valid_from_id=Configuration.objects.get(valid_from='2024-01-01').id,
        valid_to_id=Configuration.objects.get(valid_to='2099-12-31').id,
    )


def reverse_init_activity_schema_data(apps, schema_monitor):
    '''
    Remove initial data from erc.base_schema
    '''
    ActivitySchema = apps.get_model('reporting', 'ActivityJsonSchema')
    ReportingActivity = apps.get_model('registration', 'ReportingActivity')
    ActivitySchema.objects.filter(
        reporting_activity_id=ReportingActivity.objects.get(name='General stationary combustion').id
    ).delete()


# SOURCE TYPE
def init_activity_source_type_schema_data(apps, schema_monitor):
    '''
    Add initial schema data to erc.activity_source_type_schema
    '''
    ## Import JSON data
    import os

    cwd = os.getcwd()
    with open(f'{cwd}/reporting/json_schemas/2024/general_stationary_combustion/with_useful_energy.json') as gsc_st1:
        schema1 = json.load(gsc_st1)
    with open(f'{cwd}/reporting/json_schemas/2024/general_stationary_combustion/without_useful_energy.json') as gsc_st2:
        schema2 = json.load(gsc_st2)

    ActivitySourceTypeSchema = apps.get_model('reporting', 'ActivitySourceTypeJsonSchema')
    ReportingActivity = apps.get_model('registration', 'ReportingActivity')
    SourceType = apps.get_model('registration', 'SourceType')
    Configuration = apps.get_model('registration', 'Configuration')
    ActivitySourceTypeSchema.objects.bulk_create(
        [
            ActivitySourceTypeSchema(
                reporting_activity_id=ReportingActivity.objects.get(name='General stationary combustion').id,
                source_type_id=SourceType.objects.get(
                    name='General stationary combustion of fuel or waste with production of useful energy'
                ).id,
                json_schema=schema1,
                valid_from_id=Configuration.objects.get(valid_from='2024-01-01').id,
                valid_to_id=Configuration.objects.get(valid_to='2099-12-31').id,
            ),
            ActivitySourceTypeSchema(
                reporting_activity_id=ReportingActivity.objects.get(name='General stationary combustion').id,
                source_type_id=SourceType.objects.get(
                    name='General stationary combustion of waste without production of useful energy'
                ).id,
                json_schema=schema2,
                valid_from_id=Configuration.objects.get(valid_from='2024-01-01').id,
                valid_to_id=Configuration.objects.get(valid_to='2099-12-31').id,
            ),
        ]
    )


def reverse_init_activity_source_type_schema_data(apps, schema_monitor):
    '''
    Remove initial data from erc.base_schema
    '''
    ActivitySourceTypeJsonSchema = apps.get_model('reporting', 'ActivitySourceTypeJsonSchema')
    ReportingActivity = apps.get_model('registration', 'ReportingActivity')
    ActivitySourceTypeJsonSchema.objects.filter(
        reporting_activity_id=ReportingActivity.objects.get(name='General stationary combustion').id
    ).delete()


class Migration(migrations.Migration):

    dependencies = [
        ('reporting', '0007_prod_data'),
    ]

    operations = [
        migrations.RunPython(init_activity_schema_data, reverse_init_activity_schema_data, elidable=True),
        migrations.RunPython(
            init_activity_source_type_schema_data, reverse_init_activity_source_type_schema_data, elidable=True
        ),
    ]
