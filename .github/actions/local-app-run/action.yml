name: "Local registration app run"
description: "Runs the registration app locally"
runs:
  using: composite
  steps:
    # - name: start postgres and create database
    #   shell: bash
    #   run: make start_pg && make create_db
    # - name: deploy migrations
    #   shell: bash
    #   run: docker run --network=host -e "PGUSER=postgres" ghcr.io/bcgov/cas-cif-schema:${{ github.sha }} make migrate
    # - name: deploy mocks_schema migrations
    #   shell: bash
    #   run: docker run --network=host -e "PGUSER=postgres" --workdir="/root/mocks_schema" ghcr.io/bcgov/cas-cif-schema:${{ github.sha }} sqitch deploy
    - name: start backend
      shell: bash
      run: docker run -d --network=host -p 8000:8000 ghcr.io/bcgov/cas-reg-backend:${{ github.sha }} "/usr/bin/env" "bash" "-c" "make run"
    - name: start frontend
      shell: bash
      run: docker run -d --network=host -p 3004:3004 ghcr.io/bcgov/cas-reg-frontend:${{ github.sha }} "/usr/bin/env" "bash" "-c" "yarn start"
